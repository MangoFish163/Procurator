# Procurator 改进与演进路线图

本文档记录了项目的技术债治理进度、已完成的优化项以及未来的演进规划。

## ✅ 已完成 (Completed)

### Phase 1: 核心架构升级
- [x] **Redis Stream 集成**: 实现了生产级的队列后端，支持 Consumer Group 和 ACK 机制。
- [x] **任务持久化**: 实现了 `tasks` 表，完整记录任务生命周期（Init -> Start -> Finish）。
- [x] **Crash Recovery**: 实现了 Worker 启动时的断点续传机制（XCLAIM）。

### Phase 2: 规范与配置
- [x] **动态配置**: 引入 `registered_tasks` 和 `webhooks` 表。
- [x] **环境隔离**: 完善了 `.env` 配置体系，区分开发/生产环境。

### Phase 3: 安全与监控
- [x] **RBAC 权限体系**: 完成了基于数据库的 Token 管理与鉴权逻辑 (`auth_service.py`)。
- [x] **日志监控栈**: 成功部署 **Loki + Promtail + Grafana**，实现了日志的集中化采集与检索。
- [x] **DLQ 修复**: 修复了死信队列序列化问题，确保失败现场可追溯。

## 🚧 进行中 / 计划中 (Planned)

### Priority 1: 运维自动化与体验优化
- [ ] **Admin Dashboard**: 开发一个轻量级的前端管理后台 (Vue3/React)，可视化管理死信队列、用户权限和系统配置。
- [ ] **CI/CD 流水线**: 编写 GitHub Actions / GitLab CI 脚本，实现自动测试与 Docker 镜像构建。

### Priority 2: 深度集成与扩展
- [ ] **飞书深度集成**: 
  - 实现任务失败自动推送到飞书群组。
  - 实现 DLQ 积压告警通知。
- [ ] **任务编排**: 支持简单的 DAG（有向无环图）任务依赖执行。

### Priority 3: 性能优化
- [ ] **Redis Cluster 支持**: 升级 Redis 客户端以支持集群模式。
- [ ] **数据归档策略**: 针对 `tasks` 和 `audit_logs` 表实现定期归档或分区，防止单表过大。

## ⚠️ 风险提示 (Risk Registry)

1. **Redis 单点风险**: 当前架构强依赖 Redis，生产环境建议配置 Sentinel 或 Cluster。
2. **数据库增长**: 随着任务量增加，`tasks` 表增长速度可能很快，需关注磁盘空间和查询性能。
